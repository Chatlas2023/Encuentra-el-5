<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seguime - GPS</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 85vh; /* Ocupar toda la altura de la pantalla */
      background-color: white; /* Fondo claro por defecto */
      color: black; /* Texto oscuro por defecto */
    }

    #map {
      width: 100%;
      flex-grow: 1; /* El mapa ocupa el espacio restante */
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 5px; /* Menor margen inferior */
      position: relative; /* Para posicionar el círculo de velocidad */
    }

    /* Contenedor de información */
    #infoContainer {
      display: flex;
      flex-direction: column; /* Por defecto, en columna (vertical) */
      align-items: center;
      margin-bottom: 10px;
    }

    #status,
    #distance {
      font-size: 12px; /* Tamaño de fuente más pequeño para el estado y la distancia */
      font-weight: bold;
      text-align: center;
      margin: 0; /* Eliminar márgenes */
    }

    /* Estilos para orientación horizontal */
    @media (min-width: 601px) and (orientation: landscape) {
      #infoContainer {
        flex-direction: row; /* Colocar en la misma línea */
        justify-content: center; /* Centrar horizontalmente */
        gap: 20px; /* Espacio entre los elementos */
      }

      #status,
      #distance {
        font-size: 14px; /* Tamaño de fuente para pantallas horizontales */
      }
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 10px; /* Espacio entre botones */
      flex-wrap: wrap; /* Permitir que los botones se envuelvan en pantallas pequeñas */
      padding: 0 10px; /* Pequeño padding para evitar que los botones toquen los bordes */
      margin-bottom: 10px; /* Margen inferior para separar del borde */
    }

    button {
      padding: 6px 12px; /* Padding más pequeño */
      font-size: 12px; /* Tamaño de fuente más pequeño */
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      flex: 1; /* Los botones ocupan el espacio disponible */
      max-width: 150px; /* Ancho máximo para los botones */
    }

    button:hover {
      background-color: #0056b3;
    }

    #stopButton {
      background-color: #dc3545;
    }

    #stopButton:hover {
      background-color: #a71d2a;
    }

    #stopButton.continue {
      background-color: #28a745; /* Verde para "Continuar captura" */
    }

    #stopButton.continue:hover {
      background-color: #218838; /* Verde oscuro al pasar el mouse */
    }

    #darkModeButton {
      background-color: #333; /* Fondo oscuro para el botón de modo oscuro */
    }

    /* Estilos para el título dentro del mapa */
    #map h1 {
      position: absolute; /* Posición absoluta dentro del mapa */
      top: 10px; /* Distancia desde la parte superior del mapa */
      left: 10px; /* Distancia desde la izquierda del mapa */
      background-color: rgba(255, 255, 255, 0.9); /* Fondo blanco con transparencia */
      padding: 8px 12px; /* Espaciado interno */
      border-radius: 5px; /* Bordes redondeados */
      font-size: 16px; /* Tamaño de fuente */
      font-weight: bold; /* Texto en negrita */
      color: black; /* Color del texto */
      z-index: 1000; /* Asegura que esté por encima del mapa */
      margin: 0; /* Elimina el margen predeterminado */
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Sombra para resaltar */
    }

    /* Estilos para modo oscuro */
    body.dark-mode #map h1 {
      background-color: rgba(0, 0, 0, 0.8); /* Fondo oscuro con transparencia */
      color: white; /* Texto blanco */
    }

    /* Estilos para el círculo de velocidad */
    #speedContainer {
      position: absolute;
      top: 10px; /* Posición fija arriba */
      right: 10px; /* Posición fija a la derecha */
      text-align: center;
      z-index: 1000; /* Asegura que esté por encima del mapa */
    }

    #speedIndicator {
      width: 80px; /* Ancho más grande para el óvalo */
      height: 60px; /* Altura igual que antes */
      background-color: white; /* Fondo blanco */
      border-radius: 30px; /* Bordes redondeados para forma ovalada */
      display: flex;
      align-items: center;
      justify-content: center;
      color: black; /* Letras negras */
      font-size: 32px; /* Fuente más grande para el número */
      font-weight: bold;
      border: 4px solid red; /* Borde rojo más ancho */
    }

    #speedLabel {
      margin-top: 5px; /* Espacio entre el círculo y la leyenda */
      font-size: 14px; /* Tamaño de fuente más grande */
      font-weight: bold; /* Texto en negrita */
      color: black; /* Color del texto */
      text-shadow: 
        -1px -1px 0 white,  
         1px -1px 0 white,
        -1px  1px 0 white,
         1px  1px 0 white; /* Borde blanco alrededor del texto */
    }

    /* Estilos para el círculo de altitud */
    #altitudeContainer {
      position: absolute;
      top: 110px; /* Posición debajo del círculo de velocidad */
      right: 10px; /* Misma posición horizontal que el círculo de velocidad */
      text-align: center;
      z-index: 1000; /* Asegura que esté por encima del mapa */
    }

    #altitudeIndicator {
      width: 80px; /* Ancho más grande para el óvalo */
      height: 60px; /* Altura igual que antes */
      background-color: white; /* Fondo blanco */
      border-radius: 30px; /* Bordes redondeados para forma ovalada */
      display: flex;
      align-items: center;
      justify-content: center;
      color: black; /* Letras negras */
      font-size: 24px; /* Fuente más grande para el número */
      font-weight: bold;
      border: 4px solid #00BFFF; /* Borde celeste */
    }

    #altitudeLabel {
      margin-top: 5px; /* Espacio entre el círculo y la leyenda */
      font-size: 14px; /* Tamaño de fuente más grande */
      font-weight: bold; /* Texto en negrita */
      color: black; /* Color del texto */
      text-shadow: 
        -1px -1px 0 white,  
         1px -1px 0 white,
        -1px  1px 0 white,
         1px  1px 0 white; /* Borde blanco alrededor del texto */
    }

    /* Estilos para modo oscuro */
    body.dark-mode #speedLabel {
      color: white; /* Texto blanco */
      text-shadow: 
        -1px -1px 0 black,  
         1px -1px 0 black,
        -1px  1px 0 black,
         1px  1px 0 black; /* Borde negro alrededor del texto */
    }

    body.dark-mode #altitudeLabel {
      color: white; /* Texto blanco */
      text-shadow: 
        -1px -1px 0 black,  
         1px -1px 0 black,
        -1px  1px 0 black,
         1px  1px 0 black; /* Borde negro alrededor del texto */
    }

    /* Estilos para modo oscuro */
    body.dark-mode {
      background-color: #121212; /* Fondo oscuro */
      color: #ffffff; /* Texto blanco */
    }

    body.dark-mode #map {
      border-color: #333; /* Borde del mapa más oscuro */
    }

    body.dark-mode .buttons button {
      background-color: #444; /* Fondo de botones oscuro */
      color: #ffffff; /* Texto de botones blanco */
    }

    body.dark-mode #status,
    body.dark-mode #distance {
      color: #ffffff; /* Texto de estado y distancia en blanco */
    }

    body.dark-mode #speedIndicator {
      background-color: #333; /* Fondo del círculo oscuro */
      color: #ffffff; /* Texto del círculo en blanco */
      border: 4px solid #ff4444; /* Borde rojo más oscuro */
    }

    body.dark-mode #speedLabel {
      color: #ffffff; /* Texto "Km/h" en blanco */
    }

    body.dark-mode #altitudeIndicator {
      background-color: #333; /* Fondo del círculo oscuro */
      color: #ffffff; /* Texto del círculo en blanco */
      border: 4px solid #00BFFF; /* Borde celeste */
    }

    body.dark-mode #altitudeLabel {
      color: #ffffff; /* Texto "m" en blanco */
    }

    /* Estilos para pantallas pequeñas (orientación vertical) */
    @media (max-width: 600px) {
      h1 {
        font-size: 14px; /* Tamaño de fuente más pequeño para pantallas pequeñas */
      }
      #map {
        height: calc(45vh - 37.8px); /* Reducir 1 cm (37.8px) en orientación vertical */
      }
      .buttons {
        flex-direction: column; /* Botones en columna en pantallas pequeñas */
      }
      button {
        max-width: 100%; /* Botones ocupan todo el ancho en pantallas pequeñas */
      }
    }

    /* Estilos para pantallas grandes (orientación horizontal) */
    @media (min-width: 601px) {
      #map {
        height: calc(55vh - 37.8px); /* Reducir 1 cm (37.8px) en orientación horizontal */
      }
    }
  </style>
</head>
<body>
  <div id="map">
    <!-- Título dentro del mapa -->
    <h1>Seguime - GPS</h1>
    <!-- Círculo de velocidad -->
    <div id="speedContainer">
      <div id="speedIndicator">0</div>
      <div id="speedLabel">Velocidad</div>
    </div>
    <!-- Círculo de altitud -->
    <div id="altitudeContainer">
      <div id="altitudeIndicator">0</div>
      <div id="altitudeLabel">Altitud</div>
    </div>
  </div>
  <!-- Contenedor de información -->
  <div id="infoContainer">
    <div id="status">Obteniendo ubicación...</div>
    <div id="distance">Distancia total recorrida: 0 km</div>
  </div>
  <div class="buttons">
    <button id="clearButton">Limpiar historial</button>
    <button id="stopButton">Detener captura</button>
    <button id="shareButton">Compartir por WhatsApp</button>
    <button id="darkModeButton">Modo oscuro</button>
  </div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Variables globales
    let map;
    let polyline;
    let coordinates = [];
    let totalDistance = 0;
    const MAX_COORDINATES = 1000;
    const MIN_DISTANCE_METERS = 45; // Distancia mínima para guardar una nueva coordenada
    let watchId;
    let wakeLockSentinel = null;
    let lastPositionTime = null; // Tiempo de la última posición
    let isCapturing = true; // Estado de la captura (activa o detenida)

    // Capa de mosaicos para modo claro
    const lightTiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    });

    // Capa de mosaicos para modo oscuro (CartoDB Dark Matter)
    const darkTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '© OpenStreetMap contributors, © CartoDB'
    });

    // Inicializar el mapa
    function initMap() {
      map = L.map('map', {
        zoomControl: false // Desactiva los controles de zoom
      }).setView([0, 0], 15);

      // Agregar la capa de mosaicos clara por defecto
      lightTiles.addTo(map);

      polyline = L.polyline([], { color: 'blue', weight: 6 }).addTo(map);
    }

    // Función para alternar el modo oscuro
    function toggleDarkMode() {
      const body = document.body;
      const darkModeButton = document.getElementById('darkModeButton');
      body.classList.toggle('dark-mode');

      // Cambiar la capa de mosaicos según el modo
      if (body.classList.contains('dark-mode')) {
        lightTiles.remove(); // Quitar la capa de mosaicos clara
        darkTiles.addTo(map); // Agregar la capa de mosaicos oscura
      } else {
        darkTiles.remove(); // Quitar la capa de mosaicos oscura
        lightTiles.addTo(map); // Agregar la capa de mosaicos clara
      }

      // Guardar la preferencia en localStorage
      const isDarkMode = body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDarkMode);

      // Cambiar el texto del botón
      darkModeButton.textContent = isDarkMode ? 'Modo claro' : 'Modo oscuro';
    }

    // Aplicar el modo oscuro al cargar la página
    function applyDarkModePreference() {
      const isDarkMode = localStorage.getItem('darkMode') === 'true';
      const body = document.body;
      const darkModeButton = document.getElementById('darkModeButton');

      if (isDarkMode) {
        body.classList.add('dark-mode');
        darkModeButton.textContent = 'Modo claro';
        lightTiles.remove(); // Quitar la capa de mosaicos clara
        darkTiles.addTo(map); // Agregar la capa de mosaicos oscura
      } else {
        body.classList.remove('dark-mode');
        darkModeButton.textContent = 'Modo oscuro';
        darkTiles.remove(); // Quitar la capa de mosaicos oscura
        lightTiles.addTo(map); // Agregar la capa de mosaicos clara
      }
    }

    // Resto del código JavaScript...
  </script>
</body>
</html>
